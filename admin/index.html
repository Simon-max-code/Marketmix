<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MarketMix Admin Panel</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    * { box-sizing: border-box; }
    body { transition: background-color 0.3s ease; }
    body.dark-mode { @apply bg-gray-900 text-gray-100; }
    body.sidebar-open { overflow: hidden; }
    
    /* Sidebar Styles */
    .sidebar { transition: transform 0.3s ease; }
    .sidebar-overlay { display: none; position: fixed; inset: 0; background: rgba(0, 0, 0, 0.5); z-index: 35; }
    .sidebar-overlay.active { display: block; }
    
    /* Mobile: Sidebar slides from left */
    @media (max-width: 768px) {
      .sidebar { transform: translateX(-100%); width: 100%; max-width: 256px; }
      .sidebar.open { transform: translateX(0); }
      
      nav { left: 0 !important; }
      main { margin-left: 0 !important; margin-top: 56px; }
      #toggleSidebar { display: block; }
    }
    
    /* Desktop: Sidebar always visible */
    @media (min-width: 769px) {
      .sidebar { transform: translateX(0); }
      nav { left: 256px !important; }
      main { margin-left: 256px !important; }
      .sidebar-overlay { display: none !important; }
      #toggleSidebar { display: none; }
    }
    
    .chart-placeholder { @apply bg-gradient-to-br from-blue-400 to-blue-600 rounded-lg; height: 250px; }
    .modal { display: none; }
    .modal.active { display: block; }
    .toast { animation: slideIn 0.3s ease forwards; }
    @keyframes slideIn { from { transform: translateX(100%); } to { transform: translateX(0); } }
  </style>
</head>
<body class="bg-gray-50">

  <!-- Session Check Script -->
  <script>
    // Check if user is logged in
    window.addEventListener('DOMContentLoaded', () => {
      const session = localStorage.getItem('adminSession');
      if (!session) {
        // Redirect to login if not authenticated
        window.location.href = 'login.html';
      }
    });
  </script>

  <!-- Sidebar Overlay (mobile) -->
  <div id="sidebarOverlay" class="sidebar-overlay"></div>

  <!-- Sidebar -->
  <aside id="sidebar" class="sidebar fixed left-0 top-0 w-64 h-screen bg-white dark:bg-gray-800 shadow-lg z-40 overflow-y-auto">
    <div class="p-6 border-b border-gray-200 dark:border-gray-700">
      <h1 class="text-2xl font-bold text-blue-600">MarketMix</h1>
      <p class="text-xs text-gray-500 mt-1">Admin Panel</p>
    </div>

    <nav class="mt-6">
      <a href="javascript:void(0);" onclick="loadPage('dashboard'); return false;" class="nav-link flex items-center px-6 py-3 text-gray-700 dark:text-gray-200 hover:bg-blue-50 dark:hover:bg-gray-700 border-l-4 border-transparent hover:border-blue-600">
        <i class="fas fa-home mr-3 w-5"></i> Dashboard
      </a>
      <a href="javascript:void(0);" onclick="loadPage('buyers'); return false;" class="nav-link flex items-center px-6 py-3 text-gray-700 dark:text-gray-200 hover:bg-blue-50 dark:hover:bg-gray-700 border-l-4 border-transparent hover:border-blue-600">
        <i class="fas fa-users mr-3 w-5"></i> Buyers
      </a>
      <a href="javascript:void(0);" onclick="loadPage('sellers'); return false;" class="nav-link flex items-center px-6 py-3 text-gray-700 dark:text-gray-200 hover:bg-blue-50 dark:hover:bg-gray-700 border-l-4 border-transparent hover:border-blue-600">
        <i class="fas fa-store mr-3 w-5"></i> Sellers
      </a>
      <a href="javascript:void(0);" onclick="loadPage('products'); return false;" class="nav-link flex items-center px-6 py-3 text-gray-700 dark:text-gray-200 hover:bg-blue-50 dark:hover:bg-gray-700 border-l-4 border-transparent hover:border-blue-600">
        <i class="fas fa-box mr-3 w-5"></i> Products
      </a>
      <a href="javascript:void(0);" onclick="loadPage('orders'); return false;" class="nav-link flex items-center px-6 py-3 text-gray-700 dark:text-gray-200 hover:bg-blue-50 dark:hover:bg-gray-700 border-l-4 border-transparent hover:border-blue-600">
        <i class="fas fa-receipt mr-3 w-5"></i> Orders
      </a>
      <a href="javascript:void(0);" onclick="loadPage('categories'); return false;" class="nav-link flex items-center px-6 py-3 text-gray-700 dark:text-gray-200 hover:bg-blue-50 dark:hover:bg-gray-700 border-l-4 border-transparent hover:border-blue-600">
        <i class="fas fa-list mr-3 w-5"></i> Categories
      </a>
      <a href="javascript:void(0);" onclick="loadPage('reports'); return false;" class="nav-link flex items-center px-6 py-3 text-gray-700 dark:text-gray-200 hover:bg-blue-50 dark:hover:bg-gray-700 border-l-4 border-transparent hover:border-blue-600">
        <i class="fas fa-chart-bar mr-3 w-5"></i> Reports
      </a>
      <a href="javascript:void(0);" onclick="loadPage('transactions'); return false;" class="nav-link flex items-center px-6 py-3 text-gray-700 dark:text-gray-200 hover:bg-blue-50 dark:hover:bg-gray-700 border-l-4 border-transparent hover:border-blue-600">
        <i class="fas fa-credit-card mr-3 w-5"></i> Transactions
      </a>
      <a href="javascript:void(0);" onclick="loadPage('returns'); return false;" class="nav-link flex items-center px-6 py-3 text-gray-700 dark:text-gray-200 hover:bg-blue-50 dark:hover:bg-gray-700 border-l-4 border-transparent hover:border-blue-600">
        <i class="fas fa-undo mr-3 w-5"></i> Returns & Refunds
      </a>
      <a href="javascript:void(0);" onclick="loadPage('admin-users'); return false;" class="nav-link flex items-center px-6 py-3 text-gray-700 dark:text-gray-200 hover:bg-blue-50 dark:hover:bg-gray-700 border-l-4 border-transparent hover:border-blue-600">
        <i class="fas fa-user-shield mr-3 w-5"></i> Admin Users
      </a>
      <a href="javascript:void(0);" onclick="loadPage('settings'); return false;" class="nav-link flex items-center px-6 py-3 text-gray-700 dark:text-gray-200 hover:bg-blue-50 dark:hover:bg-gray-700 border-l-4 border-transparent hover:border-blue-600">
        <i class="fas fa-cog mr-3 w-5"></i> Settings
      </a>
    </nav>
  </aside>

  <!-- Top Navbar -->
  <nav class="fixed top-0 right-0 bg-white dark:bg-gray-800 shadow z-30 h-16 flex items-center px-4 md:px-6 border-b border-gray-200 dark:border-gray-700" style="left: 256px;">
    <button id="toggleSidebar" onclick="toggleSidebar()" class="text-gray-600 dark:text-gray-300 mr-4 md:hidden">
      <i class="fas fa-bars text-xl"></i>
    </button>
    
    <div class="flex-1"></div>

    <div class="flex items-center gap-4">
      <div class="relative">
        <button onclick="toggleNotificationBell()" class="text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white">
          <i class="fas fa-bell text-lg"></i>
          <span class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center">3</span>
        </button>
      </div>

      <div class="w-px h-6 bg-gray-200 dark:bg-gray-700"></div>

      <div class="relative">
        <button onclick="toggleProfileDropdown()" class="flex items-center gap-2 hover:bg-gray-100 dark:hover:bg-gray-700 px-3 py-2 rounded">
          <img src="https://via.placeholder.com/32" alt="Admin" class="w-8 h-8 rounded-full">
          <span class="text-sm font-medium text-gray-700 dark:text-gray-200">Admin</span>
          <i class="fas fa-chevron-down text-xs text-gray-500"></i>
        </button>

        <div id="profileDropdown" class="hidden absolute right-0 mt-2 w-48 bg-white dark:bg-gray-700 rounded shadow-lg py-2 z-50">
          <a href="javascript:void(0);" onclick="loadPage('profile'); toggleProfileDropdown()" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-600">Profile</a>
          <a href="javascript:void(0);" onclick="loadPage('settings'); toggleProfileDropdown()" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-600">Settings</a>
          <div class="border-t border-gray-200 dark:border-gray-600 my-2"></div>
          <a href="javascript:void(0);" onclick="handleLogout()" class="block px-4 py-2 text-sm text-red-600 hover:bg-gray-100 dark:hover:bg-gray-600"><i class="fas fa-sign-out-alt mr-2"></i>Logout</a>
        </div>
      </div>
    </div>
  </nav>

  <!-- Main Content -->
  <main class="mt-16 p-4 md:p-6" style="margin-left: 256px;">
    <div id="content"></div>
  </main>

  <!-- Modals -->
  <div id="confirmModal" class="modal hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
    <div class="bg-white dark:bg-gray-800 rounded-lg p-6 w-96">
      <h2 class="text-lg font-bold text-gray-900 dark:text-white" id="modalTitle">Confirm Action</h2>
      <p class="text-gray-600 dark:text-gray-300 mt-2" id="modalMessage">Are you sure?</p>
      <div class="flex justify-end gap-3 mt-6">
        <button onclick="closeModal()" class="px-4 py-2 text-gray-700 dark:text-gray-200 bg-gray-200 dark:bg-gray-700 rounded hover:bg-gray-300">Cancel</button>
        <button onclick="confirmAction()" class="px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700">Delete</button>
      </div>
    </div>
  </div>

  <!-- Password Change Modal -->
  <div id="passwordModal" class="modal hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
    <div class="bg-white dark:bg-gray-800 rounded-lg p-6 w-96">
      <h2 class="text-lg font-bold text-gray-900 dark:text-white">Change Password</h2>
      <div class="space-y-4 mt-4">
        <div>
          <label class="block text-gray-700 dark:text-gray-300 text-sm mb-1">Current Password</label>
          <input type="password" id="currentPass" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded dark:bg-gray-700 dark:text-white">
        </div>
        <div>
          <label class="block text-gray-700 dark:text-gray-300 text-sm mb-1">New Password</label>
          <input type="password" id="newPass" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded dark:bg-gray-700 dark:text-white">
        </div>
        <div>
          <label class="block text-gray-700 dark:text-gray-300 text-sm mb-1">Confirm Password</label>
          <input type="password" id="confirmPass" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded dark:bg-gray-700 dark:text-white">
        </div>
      </div>
      <div class="flex justify-end gap-3 mt-6">
        <button onclick="closePasswordModal()" class="px-4 py-2 text-gray-700 dark:text-gray-200 bg-gray-200 dark:bg-gray-700 rounded hover:bg-gray-300">Cancel</button>
        <button onclick="savePassword()" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">Save</button>
      </div>
    </div>
  </div>

    <div id="adminUserModal" class="modal hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
      <div class="bg-white dark:bg-gray-800 rounded-lg p-6 w-96">
        <h2 class="text-lg font-bold text-gray-900 dark:text-white" id="adminUserTitle">Add Admin User</h2>
        <div class="space-y-4 mt-4">
          <div>
            <label class="block text-gray-700 dark:text-gray-300 text-sm mb-1">Name</label>
            <input type="text" id="adminUserName" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded dark:bg-gray-700 dark:text-white">
          </div>
          <div>
            <label class="block text-gray-700 dark:text-gray-300 text-sm mb-1">Email</label>
            <input type="email" id="adminUserEmail" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded dark:bg-gray-700 dark:text-white">
          </div>
          <div>
            <label class="block text-gray-700 dark:text-gray-300 text-sm mb-1">Role</label>
            <select id="adminUserRole" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded dark:bg-gray-700 dark:text-white">
              <option>Super Admin</option>
              <option>Support</option>
              <option>Moderator</option>
            </select>
          </div>
        </div>
        <div class="flex justify-end gap-3 mt-6">
          <button onclick="closeAdminUserModal()" class="px-4 py-2 text-gray-700 dark:text-gray-200 bg-gray-200 dark:bg-gray-700 rounded hover:bg-gray-300">Cancel</button>
          <button onclick="saveAdminUser()" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700" id="adminUserBtn">Add</button>
        </div>
      </div>
    </div>

    <!-- Chart.js for reports -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>

    <script src="js/app.js"></script>
    <script src="js/pages.js"></script>
    <script src="js/helpers.js"></script>
</body>
</html>
